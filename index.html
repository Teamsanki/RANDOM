<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer Tic-Tac-Toe</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    .board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 5px;
      justify-content: center;
    }
    .cell {
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid black;
      font-size: 2rem;
      cursor: pointer;
    }
    .cell.taken {
      pointer-events: none;
    }
    #status {
      margin-top: 20px;
      font-size: 1.2rem;
    }
    #login-container {
      margin-top: 100px;
    }
    #lobby-container {
      display: none;
    }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js"></script>
</head>
<body>
  <h1>Multiplayer Tic-Tac-Toe</h1>
  
  <!-- Splash Screen -->
  <div id="splash-screen">
    <h2>Welcome to the Game!</h2>
    <p>Loading...</p>
  </div>

  <!-- Login Button -->
  <div id="login-container">
    <button id="google-login" onclick="googleLogin()">Login with Google</button>
  </div>

  <!-- Lobby Page -->
  <div id="lobby-container">
    <button onclick="createGame()">Create Game</button>
    <input type="text" id="game-id-input" placeholder="Enter Game ID to Join">
    <button onclick="joinGame()">Join Game</button>
  </div>

  <!-- Game Board -->
  <div class="board" id="board" style="display: none;"></div>
  <div id="status" style="display: none;"></div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAemwBwNix4TbWHA7vrh5ubQaRqEY8VWKk",
    authDomain: "social-bite-skofficial.firebaseapp.com",
    databaseURL: "https://social-bite-skofficial-default-rtdb.firebaseio.com",
    projectId: "social-bite-skofficial",
    storageBucket: "social-bite-skofficial.appspot.com",
    messagingSenderId: "239722707022",
    appId: "1:239722707022:web:57d9b173f2163e85be2b1f"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Splash Screen Timeout
    setTimeout(() => {
      document.getElementById('splash-screen').style.display = 'none';
      document.getElementById('login-container').style.display = 'block';
    }, 2000); // Show splash screen for 2 seconds

    // Google Login Function
    function googleLogin() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then((result) => {
        const user = result.user;
        console.log("Logged in as:", user.displayName, user.email);
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('lobby-container').style.display = 'block';
      }).catch((error) => {
        console.error("Error during login:", error.message);
      });
    }

    // Create Game Function
    function createGame() {
      const gameId = generateRandomId();
      const userId = auth.currentUser.uid;
      firebase.database().ref(gameId).set({
        board: Array(9).fill(''),
        currentPlayer: 'X',
        players: 1,
        player1: userId
      }).then(() => {
        document.getElementById('lobby-container').style.display = 'none';
        startGame(gameId, userId, 'X');
      });
    }

    // Join Game Function
    function joinGame() {
      const gameId = document.getElementById('game-id-input').value;
      const userId = auth.currentUser.uid;
      firebase.database().ref(gameId).once('value', (snapshot) => {
        const gameData = snapshot.val();
        if (gameData && gameData.players === 1) {
          gameData.players = 2;
          gameData.player2 = userId;
          firebase.database().ref(gameId).set(gameData).then(() => {
            document.getElementById('lobby-container').style.display = 'none';
            startGame(gameId, userId, 'O');
          });
        } else {
          alert('Game not available or full');
        }
      });
    }

    // Start the Game
    function startGame(gameId, userId, symbol) {
      document.getElementById('board').style.display = 'grid';
      document.getElementById('status').style.display = 'block';
      let playerSymbol = symbol;
      let isPlayerTurn = false;

      // Game Initialization
      firebase.database().ref(gameId).once('value', (snapshot) => {
        const gameData = snapshot.val();
        if (gameData.currentPlayer === playerSymbol) {
          isPlayerTurn = true;
          document.getElementById('status').textContent = "Your turn!";
        } else {
          document.getElementById('status').textContent = "Waiting for opponent...";
        }
      });

      // Firebase listener for game updates
      firebase.database().ref(gameId).on('value', (snapshot) => {
        const gameData = snapshot.val();
        if (gameData) {
          updateBoard(gameData.board);
          isPlayerTurn = gameData.currentPlayer === playerSymbol;
          document.getElementById('status').textContent = isPlayerTurn ? "Your turn!" : "Waiting for opponent...";
        }
      });

      // Game Move Handling
      const cells = document.querySelectorAll('.cell');
      cells.forEach((cell, index) => {
        cell.addEventListener('click', function() {
          if (isPlayerTurn) {
            firebase.database().ref(gameId).once('value', (snapshot) => {
              const gameData = snapshot.val();
              if (gameData.board[index] === '') {
                gameData.board[index] = playerSymbol;
                gameData.currentPlayer = playerSymbol === 'X' ? 'O' : 'X';
                firebase.database().ref(gameId).set(gameData);
              }
            });
          }
        });
      });
    }

    // Function to generate random user ID
    function generateRandomId() {
      return Math.random().toString(36).substr(2, 9);  // Generate a 9-character random string
    }

    // Update Game Board UI
    function updateBoard(boardState) {
      const cells = document.querySelectorAll('.cell');
      cells.forEach((cell, index) => {
        cell.textContent = boardState[index];
        cell.classList.toggle('taken', boardState[index] !== '');
      });
    }

    // Create Game Board UI
    for (let i = 0; i < 9; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      board.appendChild(cell);
    }
  </script>
</body>
</html>
